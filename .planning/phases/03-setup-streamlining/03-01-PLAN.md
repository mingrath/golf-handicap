---
phase: 03-setup-streamlining
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/setup/page.tsx
  - src/app/handicap/page.tsx
  - src/app/turbo/page.tsx
autonomous: true

must_haves:
  truths:
    - "A user who accepts all defaults can go from 'New Game' to the play screen in 3 steps: (1) tap New Game, (2) enter player names, (3) tap Start Game"
    - "Handicap configuration is accessible from the setup page via a collapsible section"
    - "Turbo hole configuration is accessible from the setup page via a collapsible section"
    - "Handicap and turbo sections pre-fill with sensible defaults (0 handicap, no turbo holes) so users can skip them entirely"
    - "Existing tests continue to pass (86 tests)"
  artifacts:
    - path: "src/app/setup/page.tsx"
      provides: "Redesigned setup page with Start Game fast path and collapsible config sections"
      contains: "handleStartGame"
    - path: "src/app/handicap/page.tsx"
      provides: "Handicap page updated with backHref to /setup"
      contains: "backHref"
    - path: "src/app/turbo/page.tsx"
      provides: "Turbo page updated with backHref to /setup"
      contains: "backHref"
  key_links:
    - from: "src/app/setup/page.tsx"
      to: "game-store initializeHandicaps()"
      via: "handleStartGame calls initializeHandicaps before router.push('/play')"
      pattern: "initializeHandicaps.*router\\.push.*play"
    - from: "src/app/setup/page.tsx"
      to: "/play route"
      via: "Start Game button navigates directly to play screen"
      pattern: "router\\.push.*\"/play\""
    - from: "src/app/setup/page.tsx"
      to: "game-store toggleTurboHole()"
      via: "Inline turbo section uses store's toggleTurboHole"
      pattern: "toggleTurboHole"
---

<objective>
Redesign the setup flow so users accepting all defaults can start a game in 3 steps (New Game -> enter names -> Start Game), while retaining full handicap and turbo configuration as optional collapsible sections on the setup page.

Purpose: Eliminate mandatory navigation through empty handicap and turbo pages for the majority use case (no handicaps, no turbo). The store already supports this fast path; only the UI enforces the 4-step linear flow.

Output: Streamlined setup page with primary "Start Game" action and optional expandable handicap/turbo configuration sections. Updated handicap and turbo sub-pages with correct back-navigation.
</objective>

<execution_context>
@/Users/ohmmingrath/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohmmingrath/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-setup-streamlining/03-RESEARCH.md
@src/app/setup/page.tsx
@src/app/handicap/page.tsx
@src/app/turbo/page.tsx
@src/lib/game-store.ts
@src/components/shared/step-indicator.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign setup page with Start Game fast path and collapsible config sections</name>
  <files>src/app/setup/page.tsx</files>
  <action>
Rewrite the setup page to combine player/hole configuration with a primary "Start Game" action and optional collapsible handicap/turbo sections. Specific changes:

**1. Remove the step indicator.** Delete the `STEPS` constant and `<StepIndicator>` usage. The setup page is now a single destination, not step 1 of 4. Remove the `StepIndicator` import.

**2. Add store imports.** Import `initializeHandicaps`, `toggleTurboHole`, `setHandicap`, `setHandicapHoles` from useGameStore. Import `generatePairs`, `getPlayerName` from `@/lib/pairs`. Import `ChevronDown`, `Settings2`, `Zap`, `Rocket` from lucide-react (keep existing icons too). Import `PairKey` type if needed for handicap UI.

**3. Add local state for section expansion.** Add two `useState<boolean>` hooks: `showHandicaps` (default false) and `showTurbo` (default false).

**4. Replace `handleNext` with `handleStartGame`.** The new handler:
```typescript
const handleStartGame = () => {
  const finalPlayers = players.map((p, i) => ({
    ...p,
    name: p.name.trim() || `Player ${i + 1}`,
  }));
  setPlayers(finalPlayers);
  setNumberOfHoles(numberOfHoles);
  initializeHandicaps();
  router.push("/play");
};
```
Key difference: calls `initializeHandicaps()` (creates zero-valued entries for all pairs) and navigates directly to `/play`, skipping handicap and turbo pages.

**5. Add collapsible Handicap section** below the Players card. Use CSS `grid-template-rows: 0fr/1fr` transition for smooth expand/collapse animation. The section header shows:
- Left: Settings2 icon + "Handicaps" title + summary when collapsed ("No handicaps -- equal match" or "{N} pair(s) configured")
- Right: ChevronDown icon that rotates 180deg when expanded

When expanded, render a compact version of the handicap config: for each pair (from `generatePairs(players)`), show the pair names and a `NumberStepper` for the handicap value. Only show hole selection UI when a pair's handicap value is non-zero (same logic as current /handicap page). Use the same `setHandicap` and `setHandicapHoles` store actions. Note: `initializeHandicaps()` must be called when the section is first expanded if `config.handicaps` is empty -- call it in the toggle handler: `if (!Object.keys(config?.handicaps ?? {}).length) initializeHandicaps();`.

For the handicap section, players must already be committed to the store. When expanding handicaps for the first time, call `setPlayers(finalPlayers)` and `setNumberOfHoles(numberOfHoles)` first so `generatePairs` has valid data, then call `initializeHandicaps()`.

**6. Add collapsible Turbo section** below the Handicap section. Same expand/collapse pattern. Header shows:
- Left: Zap icon + "Turbo Holes" title + summary when collapsed ("No turbo holes" or "{N} turbo hole(s) selected")
- Right: ChevronDown icon

When expanded, render the same turbo hole grid as the current /turbo page: a grid of numbered buttons (1 to numberOfHoles) that toggle turbo status via `toggleTurboHole`. Same styling as current turbo page (amber gradient for selected, slate for unselected). Like handicaps, commit players/holes to store when first expanding if needed.

**7. Update the bottom button.** Replace "Next: Set Handicaps" with "Start Game" using a Rocket icon. Keep the same gradient styling. The button text should be "Start Game" regardless of whether handicap/turbo sections have been configured.

**8. Styling details:**
- Collapsible sections use `glass-card` class for consistency
- Transition: `className="grid transition-[grid-template-rows] duration-300 ease-out"` with `style={{ gridTemplateRows: isOpen ? "1fr" : "0fr" }}` and child `<div className="overflow-hidden">`
- ChevronDown rotation: `className={cn("h-4 w-4 text-slate-400 transition-transform", isOpen && "rotate-180")}`  (or template literal equivalent since cn may not be imported)
- Section headers are `button` elements with `w-full flex items-center justify-between p-4`
- Keep the `pb-28` bottom padding on the scrollable area to account for the fixed bottom button

**9. Keep `canContinue` validation** requiring non-empty names and >= 2 players. This gates the Start Game button. Users must enter at least player names before starting.
  </action>
  <verify>
1. Run `npm test` -- all 86 existing tests must pass (this task only changes UI, not store logic)
2. Run `npm run build` -- no TypeScript or build errors
3. Manual quick-check: The setup page should show player inputs, hole stepper, collapsible Handicaps section, collapsible Turbo section, and a "Start Game" button. No step indicator.
  </verify>
  <done>
Setup page has a "Start Game" button that calls initializeHandicaps() and navigates to /play. Handicap and turbo configuration are available as collapsible sections with smart defaults. No step indicator shown. All existing tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update handicap and turbo sub-pages for setup-centric navigation</name>
  <files>src/app/handicap/page.tsx, src/app/turbo/page.tsx</files>
  <action>
Update the handicap and turbo pages so they navigate back to /setup (not to each other) and remove the mandatory linear flow assumptions. These pages remain functional as standalone config pages but are no longer in the default path.

**Handicap page (`src/app/handicap/page.tsx`):**
1. Remove `StepIndicator` -- delete the `STEPS` constant, the `StepIndicator` import, and the `<StepIndicator>` JSX.
2. Change `backHref` on GameHeader from `"/setup"` to `"/setup"` (already correct, but verify it stays).
3. Change the bottom button from "Next: Turbo Holes" / `router.push("/turbo")` to "Back to Setup" / `router.push("/setup")`. Use a different visual treatment: instead of the prominent emerald gradient, use a secondary style (`bg-slate-800/80 border border-slate-700/50 text-slate-300`). Keep the validation that all handicap holes are selected before allowing navigation (the `allComplete` check stays). When incomplete, show the same warning text as before. When complete, the button says "Done -- Back to Setup" and navigates to `/setup`.
4. Keep all existing handicap configuration logic unchanged -- the `initializeHandicaps()` call in useEffect is still needed for users who navigate directly to /handicap.

**Turbo page (`src/app/turbo/page.tsx`):**
1. Remove `StepIndicator` -- delete the `STEPS` constant, the `StepIndicator` import, and the `<StepIndicator>` JSX.
2. Change `backHref` on GameHeader from `"/handicap"` to `"/setup"`.
3. Change the bottom button from "Start Game" / `router.push("/play")` to "Done -- Back to Setup" / `router.push("/setup")`. Use a secondary button style (same as handicap page: `bg-slate-800/80 border border-slate-700/50 text-slate-300`). Remove the Rocket icon.
4. Keep all existing turbo toggle logic unchanged.

**Why these changes:** Users now configure handicaps and turbo inline on the setup page. The standalone pages serve as fallback/advanced access. They should not claim to be part of a linear wizard (no step indicator) and should return the user to the setup page rather than continuing to the next step.
  </action>
  <verify>
1. Run `npm test` -- all 86 existing tests must pass
2. Run `npm run build` -- no TypeScript or build errors
3. Manual quick-check: /handicap page shows no step indicator, back arrow goes to /setup, bottom button says "Done -- Back to Setup". /turbo page shows no step indicator, back arrow goes to /setup, bottom button says "Done -- Back to Setup".
  </verify>
  <done>
Handicap and turbo pages no longer show step indicator, navigate back to /setup instead of continuing a linear flow, and use secondary button styling. The "Start Game" action lives exclusively on the setup page. All existing tests pass.
  </done>
</task>

</tasks>

<verification>
1. **Fast path test:** From home, tap "New Game" -> enter 2 player names -> tap "Start Game" -> arrives at /play with valid game state (config.handicaps populated with zero-valued entries, turboHoles = [])
2. **Handicap config test:** On setup page, expand Handicaps section -> set a non-zero handicap for one pair -> select handicap holes -> collapse section -> tap "Start Game" -> arrives at /play with configured handicaps
3. **Turbo config test:** On setup page, expand Turbo section -> select some turbo holes -> tap "Start Game" -> arrives at /play with configured turbo holes
4. **Sub-page navigation:** Navigate to /handicap directly -> back arrow goes to /setup, bottom button goes to /setup. Same for /turbo.
5. **Test suite:** `npm test` passes all 86 tests
6. **Build:** `npm run build` succeeds
</verification>

<success_criteria>
1. User accepting defaults goes from "New Game" to play screen in 3 steps (New Game -> enter names -> Start Game)
2. Handicap section is collapsed by default with "No handicaps" summary, expandable for configuration
3. Turbo section is collapsed by default with "No turbo holes" summary, expandable for configuration
4. No step indicator on setup, handicap, or turbo pages
5. All 86 existing tests pass, build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/03-setup-streamlining/03-01-SUMMARY.md`
</output>
