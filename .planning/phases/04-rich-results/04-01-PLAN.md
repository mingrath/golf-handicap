---
phase: 04-rich-results
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/chart.tsx
  - src/components/results/score-trend-chart.tsx
  - src/components/results/pair-breakdown.tsx
  - src/app/results/page.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "Results page shows a multi-line chart of each player's cumulative score across all holes"
    - "Results page shows a head-to-head section for each pair with final score, hole-by-hole wins, and handicap-adjusted strokes"
  artifacts:
    - path: "src/components/ui/chart.tsx"
      provides: "shadcn/ui chart wrapper components for Recharts"
      contains: "ChartContainer"
    - path: "src/components/results/score-trend-chart.tsx"
      provides: "Multi-line Recharts LineChart showing cumulative player scores"
      contains: "LineChart"
    - path: "src/components/results/pair-breakdown.tsx"
      provides: "Head-to-head pair breakdown component with win/loss/tie tallies"
      contains: "PairBreakdown"
  key_links:
    - from: "src/components/results/score-trend-chart.tsx"
      to: "src/components/ui/chart.tsx"
      via: "imports ChartContainer, ChartTooltip"
      pattern: "from.*@/components/ui/chart"
    - from: "src/app/results/page.tsx"
      to: "src/components/results/score-trend-chart.tsx"
      via: "renders ScoreTrendChart component"
      pattern: "<ScoreTrendChart"
    - from: "src/app/results/page.tsx"
      to: "src/components/results/pair-breakdown.tsx"
      via: "renders PairBreakdown for each pair"
      pattern: "<PairBreakdown"
---

<objective>
Add the score trend line chart and head-to-head pair breakdowns to the results page.

Purpose: RSLT-01 and RSLT-02 -- users see how scores evolved across all holes and can review pair-by-pair match details after completing a round.
Output: ScoreTrendChart component (Recharts via shadcn chart), PairBreakdown component, integrated into results page.
</objective>

<execution_context>
@/Users/ohmmingrath/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohmmingrath/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-rich-results/04-RESEARCH.md
@src/app/results/page.tsx
@src/lib/scoring.ts
@src/lib/pairs.ts
@src/lib/types.ts
@src/lib/game-store.ts
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn chart and build ScoreTrendChart + PairBreakdown components</name>
  <files>
    src/components/ui/chart.tsx
    src/components/results/score-trend-chart.tsx
    src/components/results/pair-breakdown.tsx
  </files>
  <action>
**Step 1: Install dependencies.**
```bash
npx shadcn@latest add chart
```
This installs `recharts` and creates `src/components/ui/chart.tsx` with `ChartContainer`, `ChartTooltip`, `ChartTooltipContent`, `ChartLegend`, `ChartLegendContent`.

**Step 2: Create `src/components/results/score-trend-chart.tsx`.**

A `"use client"` component that accepts `players: Player[]`, `playerScores: PlayerHoleScore[]`, and `numberOfHoles: number` as props.

Implementation details:
- Transform `playerScores` into Recharts row-per-hole format using `useMemo`:
  ```
  Array.from({ length: numberOfHoles }, (_, i) => {
    const hole = i + 1;
    const entry: Record<string, number> = { hole };
    for (const player of players) {
      const score = playerScores.find(s => s.playerId === player.id && s.holeNumber === hole);
      entry[player.id] = score?.runningTotal ?? 0;
    }
    return entry;
  })
  ```
  Only include holes that have been played (check if at least one player has a score for that hole).
- Build `chartConfig` object mapping each `player.id` to `{ label: player.name, color: "var(--chart-N)" }` where N cycles 1-5.
- For exactly 2 players: override colors to `hsl(142, 71%, 45%)` (emerald) for the first ranked player and `hsl(350, 89%, 60%)` (rose) for the second, consistent with the app's positive/negative color convention from Phase 2.
- Render `<ChartContainer config={chartConfig} className="h-[200px] w-full">` wrapping a `<LineChart data={chartData}>` with:
  - `<CartesianGrid vertical={false} strokeDasharray="3 3" />` with `stroke` set to a subtle slate color (`rgba(148, 163, 184, 0.15)`)
  - `<XAxis dataKey="hole" tickLine={false} axisLine={false} />` with `tick={{ fill: "rgba(148, 163, 184, 0.7)", fontSize: 12 }}` and `tickFormatter={(v) => \`H${v}\``}
  - `<YAxis tickLine={false} axisLine={false} />` with `tick={{ fill: "rgba(148, 163, 184, 0.7)", fontSize: 12 }}` and width of 30
  - `<ChartTooltip content={<ChartTooltipContent />} />`
  - One `<Line>` per player: `type="monotone"`, `dataKey={player.id}`, `stroke={var(--color-${player.id})}`, `strokeWidth={2}`, `dot={false}`, `activeDot={{ r: 4 }}`
- Wrap the chart in a `glass-card` div with `<h2 className="font-bold text-white mb-3">Score Trend</h2>` header.
- If no scores exist (0 holes played), render nothing (return null).

**Step 3: Create `src/components/results/pair-breakdown.tsx`.**

A `"use client"` component that accepts `players: Player[]` and `pairResults: PairHoleResult[]` as props.

Implementation details:
- Import `generatePairs`, `getPlayerName` from `@/lib/pairs`.
- Derive pair breakdown data using `useMemo`:
  - Call `generatePairs(players)` to get all pairs.
  - For each pair, filter `pairResults` by `pairKey`.
  - Tally: `playerAWins`, `playerBWins`, `ties`, `playerATotal` (sum of playerAScore), `playerBTotal` (sum of playerBScore).
  - Resolve names via `getPlayerName`.
- Render a section titled "Head to Head" with `<h2 className="font-bold text-white mb-3">`.
- For each pair, render a `glass-card` containing:
  - **Header row:** Player A name (left) vs Player B name (right) with "vs" in the middle, all in a flex layout.
  - **Score bar:** A horizontal bar (h-2 rounded-full) showing the proportion of wins. Player A's portion in emerald, Player B's portion in rose, with ties as a neutral slate segment in between. The bar widths are percentage-based: `(aWins / totalHoles) * 100`, `(ties / totalHoles) * 100`, `(bWins / totalHoles) * 100`.
  - **Stats row:** Three stat boxes below showing "X wins" (left, emerald text), "X ties" (center, slate text), "X wins" (right, rose text).
  - **Final scores:** Player A total score (left) and Player B total score (right) below the stats, using emerald for positive and rose for negative.
  - **Hole-by-hole detail (collapsed by default):** A `<details>` element with `<summary className="text-xs text-slate-500 cursor-pointer py-2">Hole details</summary>`. Inside, a compact grid showing each hole number with the pair result -- colored dot (emerald for A win, rose for B win, slate for tie).
- If only 1 pair exists (2 players), skip the outer section header -- the single card is self-explanatory.
  </action>
  <verify>
Run `npm run build` to confirm no TypeScript errors. Verify `src/components/ui/chart.tsx` exists (from shadcn install). Verify `src/components/results/score-trend-chart.tsx` and `src/components/results/pair-breakdown.tsx` exist and export their components.
  </verify>
  <done>
ScoreTrendChart renders a multi-line Recharts chart using shadcn ChartContainer with one line per player. PairBreakdown renders all C(n,2) pair head-to-head summaries with win/loss/tie tallies and proportional score bars.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate chart and pair breakdowns into results page</name>
  <files>
    src/app/results/page.tsx
  </files>
  <action>
Refactor `src/app/results/page.tsx` to include the new components.

**Changes to make:**

1. Add imports at top:
   ```typescript
   import { ScoreTrendChart } from "@/components/results/score-trend-chart";
   import { PairBreakdown } from "@/components/results/pair-breakdown";
   ```
   Also import `pairResults` from the store destructure (add to existing destructure).

2. In the JSX, after the Rankings glass-card and before the Scorecard section, add:
   ```tsx
   {/* Score Trend Chart */}
   <ScoreTrendChart
     players={config.players}
     playerScores={playerScores}
     numberOfHoles={config.numberOfHoles}
   />

   {/* Head-to-Head Pair Breakdowns */}
   <PairBreakdown
     players={config.players}
     pairResults={pairResults}
   />
   ```

3. Keep ALL existing results page functionality intact:
   - Winner celebration section (top)
   - Rankings card
   - Editable Scorecard table with edit modal
   - Bottom action buttons (Home, New Game)
   - Edit modal overlay

The page layout order should be:
1. Winner celebration (existing)
2. Rankings (existing)
3. Score Trend Chart (NEW)
4. Head-to-Head Pair Breakdowns (NEW)
5. Editable Scorecard (existing)
6. Bottom action bar (existing)
  </action>
  <verify>
Run `npm run build` to confirm the results page compiles. Run `npm test` to confirm existing tests still pass. Start dev server and navigate to `/results` with an active game to visually confirm chart and pair breakdowns render.
  </verify>
  <done>
Results page displays the score trend chart and pair breakdowns between the rankings and scorecard sections. All existing functionality (winner display, rankings, editable scorecard, navigation) remains intact.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes without errors
2. `npm test` passes (all existing tests)
3. Dev server shows results page with: winner celebration, rankings, score trend chart with lines for each player, pair breakdown cards with win/loss/tie bars, editable scorecard, and bottom action buttons
4. Chart shows cumulative running totals (not per-hole scores) on Y axis
5. Pair breakdowns show correct win/loss/tie counts matching the store's pairResults data
</verification>

<success_criteria>
- Line chart renders one line per player showing cumulative score progression across holes
- Chart uses shadcn ChartContainer with the project's CSS variable theming
- Each pair has a head-to-head card showing wins, ties, final scores, and proportional score bar
- Existing results page features (winner display, rankings, scorecard editing) are preserved
- Build passes, tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/04-rich-results/04-01-SUMMARY.md`
</output>
