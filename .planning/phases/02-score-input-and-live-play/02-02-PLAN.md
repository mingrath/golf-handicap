---
phase: 02-score-input-and-live-play
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/hooks/use-swipe.ts
  - src/components/shared/sparkline.tsx
  - src/components/shared/mini-leaderboard.tsx
  - src/app/play/page.tsx
autonomous: true

must_haves:
  truths:
    - "A mini-leaderboard showing all players ranked by running total is always visible below the stroke input area during play"
    - "Each player row in the mini-leaderboard shows an inline sparkline of their last 5 holes' cumulative score trend"
    - "User can swipe left on the play screen to go to the next hole and swipe right to go to the previous hole"
    - "Swiping does not conflict with vertical scrolling — only clearly horizontal gestures trigger hole navigation"
  artifacts:
    - path: "src/hooks/use-swipe.ts"
      provides: "Custom hook for horizontal swipe detection using native touch events"
      exports: ["useSwipe"]
    - path: "src/components/shared/sparkline.tsx"
      provides: "Inline SVG polyline sparkline for 2-5 data points"
      exports: ["Sparkline"]
    - path: "src/components/shared/mini-leaderboard.tsx"
      provides: "Always-visible ranked player list with running totals and sparklines"
      exports: ["MiniLeaderboard"]
    - path: "src/app/play/page.tsx"
      provides: "Play page integrating MiniLeaderboard below input and useSwipe for hole navigation"
  key_links:
    - from: "src/hooks/use-swipe.ts"
      to: "src/app/play/page.tsx"
      via: "useSwipe hook attached to main container's touch handlers"
      pattern: "useSwipe\\("
    - from: "src/components/shared/sparkline.tsx"
      to: "src/components/shared/mini-leaderboard.tsx"
      via: "Sparkline rendered inline in each player row"
      pattern: "import.*Sparkline.*from.*sparkline"
    - from: "src/components/shared/mini-leaderboard.tsx"
      to: "src/app/play/page.tsx"
      via: "MiniLeaderboard rendered below stroke input, always visible"
      pattern: "import.*MiniLeaderboard.*from.*mini-leaderboard"
    - from: "src/components/shared/mini-leaderboard.tsx"
      to: "src/lib/scoring.ts"
      via: "getRunningTotals used to compute player totals"
      pattern: "getRunningTotals"
---

<objective>
Add an always-visible mini-leaderboard with per-player sparklines below the stroke input, and enable swipe-based hole navigation on the play screen.

Purpose: During play, users need to know who's winning at a glance without switching views. The mini-leaderboard provides ranked running totals with trend sparklines. Swipe navigation lets users move between holes without tapping small buttons — critical for one-handed outdoor use.

Output: MiniLeaderboard component with inline Sparklines, useSwipe hook, and play page integration replacing the toggled scoreboard with an always-visible leaderboard.
</objective>

<execution_context>
@/Users/ohmmingrath/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohmmingrath/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-score-input-and-live-play/02-RESEARCH.md
@.planning/phases/02-score-input-and-live-play/02-01-SUMMARY.md
@src/app/play/page.tsx
@src/lib/game-store.ts
@src/lib/scoring.ts
@src/lib/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useSwipe hook, Sparkline component, and MiniLeaderboard component</name>
  <files>src/hooks/use-swipe.ts, src/components/shared/sparkline.tsx, src/components/shared/mini-leaderboard.tsx</files>
  <action>
**1. Create `src/hooks/use-swipe.ts`:**

A lightweight custom React hook detecting horizontal swipe gestures using native touch events. Must prevent accidental swipes during vertical scrolling.

```typescript
"use client";

import { useRef, useCallback } from "react";

interface SwipeHandlers {
  onTouchStart: (e: React.TouchEvent) => void;
  onTouchEnd: (e: React.TouchEvent) => void;
}

export function useSwipe(
  onSwipeLeft: () => void,
  onSwipeRight: () => void,
  threshold = 50
): SwipeHandlers {
  const startX = useRef(0);
  const startY = useRef(0);

  const onTouchStart = useCallback((e: React.TouchEvent) => {
    startX.current = e.touches[0].clientX;
    startY.current = e.touches[0].clientY;
  }, []);

  const onTouchEnd = useCallback((e: React.TouchEvent) => {
    const deltaX = e.changedTouches[0].clientX - startX.current;
    const deltaY = e.changedTouches[0].clientY - startY.current;

    // Only trigger if horizontal movement clearly exceeds vertical (not a scroll)
    if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > threshold) {
      if (deltaX > 0) onSwipeRight();
      else onSwipeLeft();
    }
  }, [onSwipeLeft, onSwipeRight, threshold]);

  return { onTouchStart, onTouchEnd };
}
```

Note: `"use client"` directive at top since it uses React hooks.

**2. Create `src/components/shared/sparkline.tsx`:**

A minimal inline SVG component that renders a polyline through normalized data points. Handles edge cases: fewer than 2 points returns null, all-equal values renders a centered horizontal line.

Interface:
```typescript
interface SparklineProps {
  data: number[];   // cumulative scores, e.g. [0, -1, -2, -1, 0]
  width?: number;   // default 60
  height?: number;  // default 20
  color?: string;   // default "#34d399" (emerald-400)
}
```

Implementation:
- If `data.length < 2`, return null (no sparkline until at least 2 holes scored)
- Normalize data: `min = Math.min(...data)`, `max = Math.max(...data)`, `range = max - min || 1`
- Map each point to `(x, y)` where `x = (i / (data.length - 1)) * width` and `y = height - ((v - min) / range) * (height - 4) - 2` (2px padding top/bottom)
- Render as `<svg>` with `<polyline>`, `fill="none"`, `strokeWidth="1.5"`, `strokeLinecap="round"`, `strokeLinejoin="round"`
- Add `className="inline-block align-middle"` to the svg
- `"use client"` NOT needed (pure render, no hooks)

**3. Create `src/components/shared/mini-leaderboard.tsx`:**

An always-visible ranked player list showing running totals and sparklines.

Interface:
```typescript
interface MiniLeaderboardProps {
  players: Player[];
  playerScores: PlayerHoleScore[];
  currentHole: number;
}
```

This component computes leaderboard data internally using `getRunningTotals` from `@/lib/scoring`:

1. Call `getRunningTotals(playerScores, currentHole)` to get each player's running total
2. For each player, compute sparkline data: iterate from `max(1, currentHole - 4)` to `currentHole`, accumulating that player's cumulative score at each hole. Use `playerScores` filtered by player and hole range. The sparkline shows the cumulative running total at each of the last 5 holes (or fewer if fewer holes scored).
3. Sort players by total descending (highest score = rank 1)
4. Assign rank numbers (handle ties: same score = same rank)

Render as a compact card:
- Header: "Leaderboard" with Trophy icon (small, inline)
- Each player row: `[rank] [name] [sparkline] [total]`
  - Rank: `#1`, `#2`, etc. in small muted text. Rank 1 gets an amber Trophy icon instead of `#1` text
  - Name: player name, truncated, `text-sm font-medium text-slate-200`
  - Sparkline: `<Sparkline data={sparklineData} />` — shows cumulative trend of last 5 holes. If no holes scored yet, show nothing (Sparkline returns null for < 2 points)
  - Total: formatted with `+` prefix for positive, colored emerald for positive / rose for negative / slate for zero, `text-base font-bold tabular-nums`
- Row styling: compact `py-2 px-3`, top player gets subtle emerald bg tint
- Card styling: `glass-card` pattern matching existing cards (bg-white/5 border border-white/10 rounded-2xl) with `p-3`

Import types from `@/lib/types`, scoring from `@/lib/scoring`, Sparkline from `./sparkline`.

`"use client"` directive needed since it uses `useMemo`.
  </action>
  <verify>
- `npm run lint` passes on all three new files
- `npm run build` succeeds
  </verify>
  <done>
useSwipe hook detects horizontal swipes with vertical-scroll guard. Sparkline renders a minimal SVG polyline for 2+ data points with division-by-zero protection. MiniLeaderboard computes ranked totals from store data and renders each player with rank, name, sparkline, and total.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate MiniLeaderboard and swipe navigation into play page</name>
  <files>src/app/play/page.tsx</files>
  <action>
Modify the play page (as left by plan 02-01) to add the MiniLeaderboard and swipe hole navigation.

**A. Add MiniLeaderboard below stroke input:**

Import `MiniLeaderboard` from `@/components/shared/mini-leaderboard`.

In the main content area (the `!showScoreboard` branch, after the stroke entry card), add the MiniLeaderboard component. It should appear BETWEEN the stroke input card and the pair results / hole rankings / running total cards. It should always be visible when in the entry view (not the full scoreboard view).

```tsx
<MiniLeaderboard
  players={config.players}
  playerScores={playerScores}
  currentHole={holeAlreadyScored ? currentHole : currentHole - 1}
/>
```

Note: Pass `currentHole - 1` when the current hole hasn't been scored yet (so the leaderboard shows totals up to the last completed hole). When the current hole IS scored, pass `currentHole` so the leaderboard includes it.

**B. Remove the scoreboard toggle:**

The mini-leaderboard replaces the toggled "Board" view. Remove:
1. The `showScoreboard` state variable
2. The "Board"/"Entry" toggle button in the header
3. The full scoreboard `<table>` view (the entire `showScoreboard ? (...)` branch)
4. The "Finish button when on scoreboard and all holes done" section

Now the page always shows the entry view with the mini-leaderboard visible below. The pair results, hole rankings, and running total cards can be REMOVED as well since their information is now captured by the mini-leaderboard (running totals) and is redundant. Keep ONLY:
- Stroke entry card (StrokeInput per player)
- MiniLeaderboard
- Pair results card (keep this — it shows the detailed pair-by-pair breakdown for the current hole which is unique information)

Remove: Hole Rankings card, Running Total card (redundant with mini-leaderboard).

**C. Wire swipe navigation:**

Import `useSwipe` from `@/hooks/use-swipe`.

Create swipe handlers:
```tsx
const swipeHandlers = useSwipe(
  () => {
    // Swipe left = go to next hole
    if (config && currentHole < config.numberOfHoles) {
      goToNextHole();
    }
  },
  () => {
    // Swipe right = go to previous hole
    goToPreviousHole();
  }
);
```

Add `goToPreviousHole` to the destructured store imports.

Attach swipe handlers to the outermost `<div>` of the page:
```tsx
<div
  className="min-h-dvh bg-slate-950 flex flex-col"
  {...swipeHandlers}
>
```

**D. Clean up imports:**

Remove any unused imports after the refactor (e.g., `generatePairs`, `getPlayerName` if no longer used after removing pair results detail — but keep them if pair results card is retained). Remove `showScoreboard` state.

**E. Ensure bottom padding accounts for MiniLeaderboard:**

The main content area should have enough bottom padding (`pb-28` or `pb-32`) so the mini-leaderboard and pair results are not hidden behind the fixed bottom action bar.
  </action>
  <verify>
- `npm run build` succeeds
- `npm run lint` passes
- `npm test` passes (no store changes)
- Manual verification: open `http://localhost:3000/play` with a configured game. The mini-leaderboard is always visible below the stroke inputs showing ranked players with totals. After scoring 2+ holes, sparklines appear next to each player. Swipe left advances to next hole, swipe right goes to previous hole. Vertical scrolling is not disrupted by the swipe handler.
  </verify>
  <done>
MiniLeaderboard is always visible below stroke input showing ranked players with running totals and sparkline trends. Scoreboard toggle is removed (replaced by always-visible leaderboard). Swipe left/right navigates between holes. Redundant Hole Rankings and Running Total cards removed. Pair results card retained for detailed matchup info.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` — full production build succeeds
2. `npm run lint` — no lint errors
3. `npm test` — all existing tests pass
4. Open the play page: mini-leaderboard is visible below stroke inputs without toggling
5. Score 3+ holes: sparklines appear showing cumulative trend for each player
6. Swipe left on the page: navigates to next hole
7. Swipe right on the page: navigates to previous hole
8. Scroll vertically: does NOT trigger swipe navigation (angle check working)
9. Mini-leaderboard updates rank order after each hole is scored
</verification>

<success_criteria>
- MiniLeaderboard always visible below stroke input (no toggle needed)
- Players ranked by running total, updated after each scored hole
- Each player row shows inline SVG sparkline of last 5 holes' cumulative scores
- Swipe left = next hole, swipe right = previous hole
- Swipe only triggers on clearly horizontal gestures (no scroll conflicts)
- All existing tests pass unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/02-score-input-and-live-play/02-02-SUMMARY.md`
</output>
