---
phase: 02-score-input-and-live-play
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/shared/stroke-input.tsx
  - src/lib/vibrate.ts
  - src/app/play/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can set a player's stroke count with a single tap on a preset number (3-7), no +/- stepping required"
    - "Outlier values (1, 2, 8, 9+) reachable via dedicated -/+ buttons flanking the preset row"
    - "After submitting all strokes, a confirmation flash ('Hole N saved') is visible for ~1 second before auto-advancing to the next hole"
    - "On the last hole, confirmation flash shows but does NOT auto-navigate — a 'View Results' CTA appears instead"
    - "Phone vibrates briefly on score submission on supported browsers (no-op on iOS/unsupported)"
  artifacts:
    - path: "src/components/shared/stroke-input.tsx"
      provides: "Single-tap preset number row component for one player"
      exports: ["StrokeInput"]
    - path: "src/lib/vibrate.ts"
      provides: "Progressive-enhancement vibration utility"
      exports: ["vibrate"]
    - path: "src/app/play/page.tsx"
      provides: "Redesigned play page with StrokeInput, confirmation flash overlay, and auto-advance logic"
  key_links:
    - from: "src/components/shared/stroke-input.tsx"
      to: "src/app/play/page.tsx"
      via: "StrokeInput component imported and rendered per player"
      pattern: "import.*StrokeInput.*from.*stroke-input"
    - from: "src/lib/vibrate.ts"
      to: "src/app/play/page.tsx"
      via: "vibrate() called on score submission"
      pattern: "vibrate\\("
    - from: "src/app/play/page.tsx"
      to: "src/lib/game-store.ts"
      via: "submitHoleStrokes + goToNextHole for auto-advance"
      pattern: "submitHoleStrokes|goToNextHole"
---

<objective>
Replace the +/- NumberStepper input on the play page with a fast, single-tap preset number row and wire auto-advance with confirmation flash and haptic feedback.

Purpose: The current NumberStepper requires multiple taps to reach common stroke values (4-6). On the course between holes, users need to enter scores as fast as possible — one tap per player. The auto-advance removes a second "Next Hole" tap and the confirmation flash prevents "did it save?" anxiety.

Output: Redesigned play page stroke entry area with StrokeInput component, vibrate utility, confirmation overlay, and auto-advance-to-next-hole logic.
</objective>

<execution_context>
@/Users/ohmmingrath/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohmmingrath/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-score-input-and-live-play/02-RESEARCH.md
@src/app/play/page.tsx
@src/lib/game-store.ts
@src/lib/scoring.ts
@src/lib/types.ts
@src/components/shared/number-stepper.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StrokeInput component and vibrate utility</name>
  <files>src/components/shared/stroke-input.tsx, src/lib/vibrate.ts</files>
  <action>
**1. Create `src/lib/vibrate.ts`:**

A progressive-enhancement utility wrapping `navigator.vibrate()`. Must guard with `"vibrate" in navigator` check AND try/catch since iOS Safari has never implemented the Vibration API and may behave unpredictably.

```typescript
export function vibrate(pattern: number | number[] = 50): void {
  if (typeof navigator !== "undefined" && "vibrate" in navigator) {
    try {
      navigator.vibrate(pattern);
    } catch {
      // Silently fail — progressive enhancement
    }
  }
}
```

**2. Create `src/components/shared/stroke-input.tsx`:**

A horizontal row of tappable preset number buttons (3, 4, 5, 6, 7) flanked by a [-] decrement button on the left and [+] increment button on the right. Designed for fast, single-tap stroke entry on the golf course.

Interface:
```typescript
interface StrokeInputProps {
  playerName: string;
  value: number;
  onChange: (value: number) => void;
}
```

Layout (one row per player):
- Left: Player name (truncated, max ~100px)
- Right: `[-]` `[3]` `[4]` `[5]` `[6]` `[7]` `[+]`
- The `[-]` button decrements value by 1 (min 1); `[+]` increments by 1 (max 20)
- When value is within 3-7, that number button is visually highlighted (emerald bg, bold white text, slight scale-up)
- When value is outside 3-7 (e.g., 2 or 8), NO preset button is highlighted — instead show the current value in the player name area or as a badge

Styling requirements:
- All tap targets minimum 48x48px (WCAG 2.5.5 AAA for outdoor use)
- Preset number buttons: `min-h-[48px] min-w-[44px]` with `rounded-xl`, `text-lg font-bold`, `active:scale-95` for tactile feedback
- Selected preset: `bg-emerald-500 text-white shadow-lg shadow-emerald-500/25`
- Unselected preset: `bg-slate-800 text-slate-400 border border-slate-700/50 hover:bg-slate-700`
- [-]/[+] buttons: `bg-slate-800 text-slate-400 border border-slate-700/50`, same 48px min size, use ChevronDown/ChevronUp or Minus/Plus icons from lucide-react
- `"use client"` directive at top

The component is purely presentational — it receives value and onChange, it does NOT import the store.
  </action>
  <verify>
- `npm run lint` passes with no errors on the two new files
- `npm run build` succeeds (no type errors, no import errors)
  </verify>
  <done>
StrokeInput component renders a preset number row (3-7) with [-]/[+] outlier buttons, all tap targets >= 48px, selected number visually highlighted. Vibrate utility exports a safe `vibrate()` function.
  </done>
</task>

<task type="auto">
  <name>Task 2: Redesign play page with StrokeInput, auto-advance, and confirmation flash</name>
  <files>src/app/play/page.tsx</files>
  <action>
Rewrite the stroke entry section and bottom action bar of `src/app/play/page.tsx` to use the new StrokeInput component and add auto-advance with confirmation flash. Keep the header, hole navigator bar, turbo badge, and scoreboard toggle exactly as they are. The changes are:

**A. Replace NumberStepper with StrokeInput in the stroke entry area:**

Replace the "Enter Strokes" card's content. Instead of `NumberStepper` per player, render `StrokeInput` per player:

```tsx
import { StrokeInput } from "@/components/shared/stroke-input";
```

Each player gets one `<StrokeInput playerName={player.name} value={strokes[player.id] ?? 4} onChange={(v) => setStrokes(prev => ({ ...prev, [player.id]: v }))} />`. Remove the `NumberStepper` import (it's still used by handicap/setup pages, just not here).

**B. Replace bottom action bar with a single "Submit Scores" button:**

Remove the conditional logic for "Next Hole" vs "Submit Scores" vs "Finish Game" in the bottom bar. Replace with:

1. If NOT on last hole: A single **"Submit Scores"** button. When tapped:
   - Call `submitHoleStrokes({ holeNumber: currentHole, strokes: { ...strokes } })`
   - Call `vibrate(50)` (import from `@/lib/vibrate`)
   - Set `showConfirmation(true)`
   - After 1000ms timeout: set `showConfirmation(false)` and call `goToNextHole()`

2. If on last hole AND hole is already scored: Show **"View Results"** button (amber/orange gradient, Trophy icon) that calls `completeGame()` then `router.push("/results")`

3. If on last hole AND hole NOT yet scored: Show **"Submit & Finish"** button. When tapped:
   - Call `submitHoleStrokes({ holeNumber: currentHole, strokes: { ...strokes } })`
   - Call `vibrate(50)`
   - Set `showConfirmation(true)`
   - After 1000ms: set `showConfirmation(false)` — do NOT auto-navigate. Let the button change to "View Results".

4. If re-scoring a previously scored non-last hole: Show **"Update Scores"** button that behaves like #1 (submit, vibrate, confirm, auto-advance).

**C. Redesign the confirmation flash as a centered overlay:**

Replace the current inline banner flash with a centered overlay that's clearly visible even in bright sunlight:

```tsx
{showConfirmation && (
  <div className="fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
    <div className="animate-in fade-in zoom-in duration-200 bg-emerald-500/20 backdrop-blur-sm rounded-3xl px-8 py-6 flex flex-col items-center gap-2">
      <Check className="h-10 w-10 text-emerald-400" />
      <span className="text-lg font-bold text-emerald-400">
        Hole {currentHole} saved
      </span>
    </div>
  </div>
)}
```

**D. Keep existing sections intact:**

- Keep the Pair Results card (`holeAlreadyScored && currentPairResults.length > 0`) as-is
- Keep the Hole Rankings card as-is
- Keep the Running Total card as-is
- Keep the Scoreboard toggle view as-is
- Keep the header and hole navigator bar as-is
- Keep the turbo badge as-is
- Keep the "Finish button when on scoreboard and all holes done" as-is

**E. Handle re-scoring edge case:**

When a user navigates back to a previously scored hole (via hole navigator), the strokes are pre-populated. The button should say "Update Scores" and after submission + confirmation, auto-advance to the next hole (same as initial scoring).

**F. Wire `goToNextHole` from store:**

Add `goToNextHole` to the destructured store imports (it already exists in the store but is not imported in the current page).

**G. Cleanup:**

Remove the `RotateCcw` icon import (no longer needed — the re-score button is removed in favor of just tapping Submit again). Remove the `NumberStepper` import.
  </action>
  <verify>
- `npm run build` succeeds with no type errors
- `npm run lint` passes
- `npm test` passes (existing tests should not break since no store changes were made)
- Manual verification: open `http://localhost:3000/play` with a configured game. Tap a preset number — value updates immediately. Tap "Submit Scores" — confirmation flash appears for ~1s, then page advances to next hole. On last hole, submit shows flash but does NOT navigate — "View Results" CTA appears.
  </verify>
  <done>
Play page uses StrokeInput for single-tap stroke entry. Bottom bar submits scores with vibration feedback and shows confirmation flash for ~1s before auto-advancing to the next hole. Last hole shows "View Results" instead of auto-navigating. Re-scoring a previous hole auto-advances after confirmation. All existing scoreboard/pair results/rankings cards remain unchanged.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` — full production build succeeds
2. `npm run lint` — no lint errors
3. `npm test` — all 86 existing tests pass (no store changes)
4. Open the app on a phone (or responsive mode): tap a preset number (3-7) and confirm value changes immediately with one tap
5. Submit scores and confirm: vibration fires (Android), confirmation flash visible for ~1s, then auto-advances
6. Navigate to last hole, submit, confirm flash shows but page does NOT navigate away — "View Results" appears
</verification>

<success_criteria>
- StrokeInput component renders preset numbers 3-7 with [-]/[+] for outliers
- All touch targets >= 48px
- Auto-advance triggers ~1s after submission (non-last holes)
- Confirmation flash is a centered, high-contrast overlay
- Vibration fires on supported browsers, silently no-ops on others
- Last hole does not auto-navigate to results
- Existing tests pass unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/02-score-input-and-live-play/02-01-SUMMARY.md`
</output>
